# Generated by Ansible for {{ ansible_hostname  }}

<system>
    log_level info
</system>    

################################################################################
# ソース
################################################################################
<source>
  @type forward
</source>

<source>
  @type http
  port 8888
</source>

<source>
  @type debug_agent
  bind 127.0.0.1
  port 24230
</source>

################################################################################
# 処理
################################################################################
<filter {sensor.**,fplug.**,wemo.**}>
  @type typecast
  types temp:float,humi:float,lux:float,rain:float,pm10:float,pm25:float,pm40:float,pm100:float,uva:float,uvb:float,uvi:float
</filter>

<match sensor>
  @type rewrite_tag_filter
  <rule>
    key     hostname
    pattern ESP32
    tag     sensor.esp32
  </rule>
  <rule>
    key     hostname
    pattern rasp
    tag     sensor.raspberrypi
  </rule>
</match>

<filter {sensor.esp32,fplug.**}>
  @type record_transformer
  enable_ruby
  renew_time_key self_time
  auto_typecast
  enable_ruby
  <record>
    self_time ${Time.now.to_i - record["self_time"].to_i }
  </record>
</filter>

<match {sensor.**,fplug.**}>
  @type influxdb
  host localhost
  dbname sensor
  tag_keys ["hostname"]
  time_precision s
  flush_interval 10
</match>

<match test.**>
  @type file
  path /dev/shm/fluent_test.log
</match>

<match fluent.{warn,error}>
  @type file
  path /var/log/td-agent/fluent.log
</match>

# Local Variables:
# mode: conf
# End:
################################################################################
